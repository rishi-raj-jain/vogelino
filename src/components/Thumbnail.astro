---
import classNames from '../utils/classNames'
import * as astroComponents from 'astro-imagetools/components'
import type { MappedNotionProject } from '../../scripts/lib/parseOriginalNotionProjects'

const { Img } = astroComponents

export interface Props extends MappedNotionProject {
	rotationClass: string
	className?: string
}
const {
	slug,
	title,
	thumbnail,
	bgImage,
	nameShort,
	rotationClass,
	highlighted,
	className = '',
	type,
	year,
} = Astro.props
---

<a
	href={`/projects/${slug}`}
	class={classNames(
		className,
		`group relative cursor-pointer @container/thumb`,
		`grid grid-cols-[1rem,1fr,3rem] grid-rows-[auto,1fr,16px]`,
		`border-y border-grayMed -mt-[1px]`,
		`hover:bg-fg hover:text-bg focus:bg-fg focus:text-bg`,
		`col-span-2 focus-visible:outline-none`,
		highlighted && `sm:col-span-4 md:col-span-2 xl:col-span-4 xl:row-span-2`,
	)}
	aria-label={title}
>
	<div
		class={classNames(
			`aspect-[16/11] relative overflow-hidden`,
			`col-span-2 border-b border-grayLight`,
			`group-hover:border-fgDark group-focus:border-fgDark`,
			`pointer-events-none bg-grayUltraLight`,
		)}
	>
		<div
			class={classNames(
				`hidden hover-hover:block absolute top-0 left-0 w-full aspect-[16/11]`,
			)}
		>
			<Img
				src={bgImage}
				alt={`Background image for project ${title}`}
				attributes={{
					img: {
						'aria-hidden': 'true',
						class:
							'object-cover w-full absolute top-0 left-0  h-full aspect-[16/11]',
					},
				}}
			/>
		</div>
		<div
			class={classNames(
				`hidden hover-hover:block`,
				`absolute inset-0 bg-grayDark mix-blend-screen`,
				`bg-fgDark group-hover:bg-fgDark group-focus:bg-fgDark`,
			)}
		>
		</div>
		<div
			class={classNames(
				`hidden hover-hover:block`,
				`absolute inset-0 bg-grayUltraLight mix-blend-multiply opacity-50`,
				`bg-fgDark group-hover:bg-fgDark group-focus:bg-fgDark`,
			)}
		>
		</div>
		<div
			class={classNames(
				`hidden hover-hover:block`,
				`absolute inset-0 bg-grayUltraLight mix-blend-color`,
				`bg-fgDark group-hover:bg-fgDark group-focus:bg-fgDark`,
			)}
		>
		</div>
		<div
			class={classNames(
				rotationClass,
				`absolute inset-4 border-2 border-alt rounded shadow-md`,
				`border-t-[12px] overflow-hidden transition`,
				`@sm/thumb:scale-95 hover-hover:opacity-0`,
				`group-hover:opacity-100 @sm/thumb:group-hover:scale-100`,
				`group-focus:opacity-100 @sm/thumb:group-focus:scale-100`,
			)}
		>
			<Img
				src={thumbnail}
				alt={title}
				attributes={{
					img: {
						class: 'w-full h-auto',
					},
				}}
			/>
		</div>
	</div>
	<div
		class={classNames(
			`relative border-x border-b border-grayLight`,
			`border-r-grayMed row-span-2`,
			`group-hover:border-fgDark`,
			`group-focus:border-fgDark`,
			`pointer-events-none`,
		)}
	>
		<div
			class={classNames(
				'absolute bottom-4 left-1 whitespace-nowrap suppercase',
				'z-10 tracking-wide leading-4 text-lg',
			)}
		>
			<p
				aria-label={`project type: ${type}`}
				class={classNames(
					'origin-bottom-left -rotate-90 translate-x-7',
					'pt-1 -mt-1',
				)}
			>
				{type.toLowerCase()}
			</p>
		</div>
		<div
			class={classNames(
				`absolute top-5 left-1 whitespace-nowrap suppercase transition`,
				`z-10 tracking-wide leading-4 text-lg text-grayDark`,
				`group-hover:text-white`,
				`group-focus:text-white`,
			)}
		>
			<p
				aria-label={`project type: ${type}`}
				class={classNames(
					'origin-bottom-left -rotate-90 translate-x-7 translate-y-full',
					'pt-1 -mt-1',
				)}
			>
				{year}
			</p>
		</div>
	</div>
	<div></div>
	<h2
		class={classNames(
			'border-l border-b border-grayLight pt-5 px-4 pb-4 uppercase',
			'group-hover:pt-[18px] group-hover:px-1 group-hover:border-fgDark',
			'group-focus:pt-[18px] group-focus:px-1 group-focus:border-fgDark',
			'text-3xl tracking-wider leading-7',
			`@xl/thumb:text-5xl @xl/thumb:leading-8`,
			`pointer-events-none flex items-center`,
		)}
	>
		<span
			class={classNames(
				`group-hover:font-special`,
				`group-hover:text-fg group-hover:bg-alt`,
				`group-hover:tracking-tight group-hover:leading-6 `,
				`group-focus:font-special`,
				`group-focus:text-fg group-focus:bg-alt`,
				`group-focus:tracking-tight group-focus:leading-6`,
				`decoration-clone rounded-full antialiased`,
				`group-hover:px-3 group-hover:-mt-1 group-hover:pb-1.5 group-hover:pt-1`,
				`group-focus:px-3 group-focus:-mt-1 group-focus:pb-1.5 group-focus:pt-1`,
				`@xl/thumb:group-hover:-mt-3 @xl/thumb:group-hover:py-4`,
				`@xl/thumb:group-focus:-mt-3 @xl/thumb:group-focus:py-4`,
			)}
			>{nameShort || title}
		</span>
	</h2>
	<div
		class={classNames(
			`col-span-3 relative bg-grayUltraLight`,
			`group-hover:bg-grayDark/10 group-hover:border-fgDark`,
			`group-focus:bg-grayDark/10 group-focus:border-fgDark`,
			`h-4 border-r border-grayMed`,
			`pointer-events-none`,
		)}
	>
		<svg
			width="16px"
			height="20px"
			viewBox="0 0 16 20"
			class="absolute bottom-0 left-0 text-bg group-hover:text-fg group-focus:text-fg"
		>
			<polygon points="0,0 16,0 16,4 0,20" fill="currentColor"></polygon>
		</svg>
		<svg
			width="17px"
			height="17px"
			viewBox="0 0 17 17"
			class="absolute bottom-0 left-0 text-grayLight group-hover:text-fgDark group-focus:text-fgDark"
		>
			<polyline points="17,0 0,17" stroke="currentColor" fill="none"></polyline>
		</svg>
	</div>
</a>
